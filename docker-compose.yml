---
version: "3.2"

services:
  sftpgo:
    build:
      context: .
      dockerfile: sftpgo/Dockerfile
      args:
        SFTP_PORT: "$SFTP_PORT"
        SFTPGO_ADMIN_UI_PORT: "$SFTPGO_ADMIN_UI_PORT"
        SFTPGO_VAULT: "$SFTPGO_VAULT"
        SFTPGO_HOME_PATH: "$SFTPGO_HOME_PATH"
    environment:
      - "SFTPGO_DEFAULT_ADMIN_USERNAME=$SFTPGO_ADMIN_USER"
      - "SFTPGO_DEFAULT_ADMIN_PASSWORD=$SFTPGO_ADMIN_PASSWORD"
      - "SFTPGO_LOG_DIR=$SFTPGO_LOG_DIR"
      - "SFTPGO_LOG_FILE_PATH=$SFTPGO_LOG_DIR/sftpgo.log"
      - "SFTPGO_HOME_PATH=$SFTPGO_HOME_PATH"
      - "IRODS_PROXY_USER=$IRODS_PROXY_USER"
      - "IRODS_PROXY_PASSWORD=$IRODS_PROXY_PASSWORD"
      - "IRODS_HOST=$IRODS_HOST"
      - "IRODS_PORT=$IRODS_PORT"
      - "IRODS_ZONE=$IRODS_ZONE"
      - "IRODS_SHARED=$IRODS_SHARED"
    ports:
      - "$SFTP_PORT:$SFTP_PORT"
      - "$SFTPGO_ADMIN_UI_PORT:$SFTPGO_ADMIN_UI_PORT"
    volumes:
      - type: volume
        source: sftpgo_home_volume
        target: "$SFTPGO_VAULT"
      - type: bind
        source: "$SFTPGO_LOG_DIR"
        target: "$SFTPGO_LOG_DIR"
  
volumes:
  sftpgo_home_volume: