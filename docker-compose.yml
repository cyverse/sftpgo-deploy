---
version: "3.2"

services:
  sftpgo:
    restart: unless-stopped
    build:
      context: .
      dockerfile: sftpgo/Dockerfile
      args:
        WEBDAV_PORT: "$WEBDAV_PORT"
        SFTP_PORT: "$SFTP_PORT"
        SFTPGO_ADMIN_UI_PORT: "$SFTPGO_ADMIN_UI_PORT"
        SFTPGO_VAULT: "$SFTPGO_VAULT"
        SFTPGO_HOME_PATH: "$SFTPGO_HOME_PATH"
        IRODS_PROXY_USER: "$IRODS_PROXY_USER"
        IRODS_PROXY_PASSWORD: "$IRODS_PROXY_PASSWORD"
        IRODS_HOST: "$IRODS_HOST"
        IRODS_PORT: "$IRODS_PORT"
        IRODS_ZONE: "$IRODS_ZONE"
        IRODS_REQUIRE_CS_NEGOTIATION: "$IRODS_REQUIRE_CS_NEGOTIATION"
        IRODS_CS_NEGOTIATION_POLICY: "$IRODS_CS_NEGOTIATION_POLICY"
        IRODS_AUTH_SCHEME: "$IRODS_AUTH_SCHEME"
        IRODS_SSL_CA_CERT_PATH: "$IRODS_SSL_CA_CERT_PATH"
        IRODS_SSL_ALGORITHM: "$IRODS_SSL_ALGORITHM"
        IRODS_SSL_KEY_SIZE: "$IRODS_SSL_KEY_SIZE"
        IRODS_SSL_SALT_SIZE: "$IRODS_SSL_SALT_SIZE"
        IRODS_SSL_HASH_ROUNDS: "$IRODS_SSL_HASH_ROUNDS"
        IRODS_SHARED: "$IRODS_SHARED"
    environment:
      - "SFTPGO_DEFAULT_ADMIN_USERNAME=$SFTPGO_ADMIN_USER"
      - "SFTPGO_DEFAULT_ADMIN_PASSWORD=$SFTPGO_ADMIN_PASSWORD"
      - "SFTPGO_LOG_DIR=$SFTPGO_LOG_DIR"
      - "SFTPGO_LOG_FILE_PATH=$SFTPGO_LOG_DIR/sftpgo.log"
      - "SFTPGO_HOME_PATH=$SFTPGO_HOME_PATH"
    ports:
      - "$WEBDAV_PORT:$WEBDAV_PORT"
      - "$SFTP_PORT:$SFTP_PORT"
      - "$SFTPGO_ADMIN_UI_PORT:$SFTPGO_ADMIN_UI_PORT"
    volumes:
      - type: volume
        source: sftpgo_home_volume
        target: "$SFTPGO_VAULT"
      - type: bind
        source: "/home/debian/sftpgo-deploy/log/"
        target: "$SFTPGO_LOG_DIR"

volumes:
  sftpgo_home_volume:
